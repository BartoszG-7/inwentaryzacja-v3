<button class="header-btn" (click)="openEditModal()">DODAJ</button>

@if (showEditModal) {
<div class="modal-backdrop open" (click)="closeEditModal()"></div>
<div class="modal-custom open">
  <div class="modal-content">
    <div class="modal-header modal-header-black">
      <span class="modal-title modal-title-black">Dodaj projekt</span>
      <button
        type="button"
        class="close"
        (click)="closeEditModal()"
        aria-label="Close"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <form #editProjectForm="ngForm" (ngSubmit)="onEditSubmit(editProjectForm)">
      <div class="modal-body">
        <input
          name="name"
          [(ngModel)]="editFormData.name"
          placeholder="Nazwa"
          required
          class="form-control mb-2"
        />
        <input
          name="dns1"
          [(ngModel)]="editFormData.dns1"
          placeholder="DNS 1"
          required
          class="form-control mb-2"
        />
        <input
          name="dns2"
          [(ngModel)]="editFormData.dns2"
          placeholder="DNS 2"
          required
          class="form-control mb-2"
        />
        <input
          name="networkAddress"
          [(ngModel)]="editFormData.networkAddress"
          required
          placeholder="Adres sieci"
          class="form-control mb-2"
        />
        <input
          name="mask"
          [(ngModel)]="editFormData.mask"
          placeholder="Maska"
          required
          class="form-control mb-2"
        />
        <input
          name="gateway"
          [(ngModel)]="editFormData.gateway"
          placeholder="Brama"
          required
          class="form-control mb-2"
        />
        <!-- Removed Pula adresów per request -->
        <!-- Wykluczone adresy as dynamic list -->
        <div class="mt-2">
          <div class="d-flex align-items-center justify-content-start gap-2 devices-header">
            <span>Wykluczone adresy</span>
            <button type="button" class="header-btn btn-edit-row btn-inline-plus" (click)="addExcludedPool()" aria-label="Dodaj wykluczony adres">
              <i class="bi bi-plus-lg" aria-hidden="true"></i>
            </button>
          </div>
          <div class="devices-rows" role="region" aria-label="Lista wykluczonych adresów">
            @for (pool of editFormData.excludedIpPools; track $index) {
              <div class="row g-2 align-items-center mb-2">
                <div class="col-11">
                  <input
                    class="form-control"
                    [name]="'exclude_'+$index"
                    [(ngModel)]="editFormData.excludedIpPools[$index]"
                    placeholder="Wykluczony adres"
                  />
                </div>
                <div class="col-1 d-flex justify-content-end">
                  <button type="button" class="modal-close-btn" (click)="removeExcludedPool($index)" [disabled]="editFormData.excludedIpPools.length===1" aria-label="Usuń adres">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              </div>
            }
          </div>
        </div>
        <input
          name="remoteAccessTag"
          [(ngModel)]="editFormData.remoteAccessTag"
          required
          placeholder="Remote Access Tag"
          class="form-control mb-2"
        />
        <div class="mt-2">
          <div class="d-flex align-items-center justify-content-start gap-2 devices-header">
            <span>Wymagane urządzenia (opcjonalnie)</span>
            <button type="button" class="header-btn btn-edit-row btn-inline-plus" (click)="addRow()" aria-label="Dodaj wiersz">
              <i class="bi bi-plus-lg" aria-hidden="true"></i>
            </button>
          </div>
          <div class="devices-rows" role="region" aria-label="Lista wymaganych urządzeń">
            @for (row of projectDeviceRows; track $index) {
              <div class="row g-2 align-items-center mb-2">
                <div class="col-8">
                  <select
                    class="form-select"
                    [name]="'type_'+$index"
                    [(ngModel)]="row.typeId"
                  >
                    <option value="">Typ urządzenia…</option>
                    @for (t of deviceTypes; track t.id) {
                      <option [value]="t.id">{{ t.name }}</option>
                    }
                  </select>
                </div>
                <div class="col-3">
                  <input
                    type="number"
                    min="1"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    class="form-control"
                    [name]="'needed_'+$index"
                    [(ngModel)]="row.needed"
                    placeholder="Ilość"
                  />
                </div>
                <div class="col-1 d-flex justify-content-end">
                  <button type="button" class="modal-close-btn" (click)="removeRow($index)" [disabled]="projectDeviceRows.length===1" aria-label="Usuń wiersz">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeEditModal()"
        >
          Anuluj
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editProjectForm.invalid"
        >
          Zapisz
        </button>
      </div>
    </form>
  </div>
</div>
}
