<button type="button" class="header-btn" (click)="openModal()">EDYTUJ</button>

@if (showModal) {
<div class="modal-backdrop open" (click)="closeModal()"></div>
<div class="modal-custom open">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Edytuj projekt</h5>
      <button
        type="button"
        class="close"
        (click)="closeModal()"
        aria-label="Close"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <form #projectForm="ngForm" (ngSubmit)="onSubmit(projectForm)">
      <div class="modal-body">
        <input
          name="projectName"
          [(ngModel)]="formData.name"
          placeholder="NAZWA PROJEKTU"
          required
          class="form-control mb-2"
        />

        <div style="display: flex; gap: 0.75rem">
          <input
            name="networkAddress"
            [(ngModel)]="formData.networkAddress"
            placeholder="ADRES SIECI"
            required
            class="form-control mb-2"
            style="flex: 1"
          />
          <input
            name="mask"
            [(ngModel)]="formData.mask"
            placeholder="MASKA"
            required
            class="form-control mb-2"
            style="width: 120px"
          />
        </div>

        <input
          name="gateway"
          [(ngModel)]="formData.gateway"
          placeholder="BRAMA"
          class="form-control mb-2"
        />
        <input
          name="dns1"
          [(ngModel)]="formData.dns1"
          placeholder="DNS_1"
          class="form-control mb-2"
        />
        <input
          name="dns2"
          [(ngModel)]="formData.dns2"
          placeholder="DNS_2"
          class="form-control mb-2"
        />

        <input
          name="remoteAccessTag"
          [(ngModel)]="formData.remoteAccessTag"
          placeholder="Remote Access Tag"
          class="form-control mb-2"
        />

        <div class="mt-2">
          <div class="d-flex align-items-center justify-content-start gap-2 devices-header">
            <span>Wykluczone adresy</span>
            <button type="button" class="header-btn btn-edit-row btn-inline-plus" (click)="addExcludedPool()" aria-label="Dodaj wykluczony adres">
              <i class="bi bi-plus-lg" aria-hidden="true"></i>
            </button>
          </div>
          <div class="devices-rows" role="region" aria-label="Lista wykluczonych adresów">
            @for (pool of formData.excludedIpPools; track $index) {
            @let i = $index;
              <div class="row g-2 align-items-center mb-2">
                <div class="col-11">
                  <input
                    class="form-control"
                    [name]="'exclude_'+i"
                    [(ngModel)]="formData.excludedIpPools[i]"
                    placeholder="Wykluczony adres"
                  />
                </div>
                <div class="col-1 d-flex justify-content-end">
                  <button type="button" class="modal-close-btn" (click)="removeExcludedPool(i)" [disabled]="formData.excludedIpPools.length===1" aria-label="Usuń adres">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="mt-2">
          <div class="d-flex align-items-center justify-content-start gap-2 devices-header">
            <span>Wymagane urządzenia (opcjonalnie)</span>
            <button type="button" class="header-btn btn-edit-row btn-inline-plus" (click)="addRow()" aria-label="Dodaj wiersz">
              <i class="bi bi-plus-lg" aria-hidden="true"></i>
            </button>
          </div>
          <div class="devices-rows" role="region" aria-label="Lista wymaganych urządzeń">
            @for (row of projectDeviceRows; track $index) {
              <div class="row g-2 align-items-center mb-2">
                <div class="col-8">
                  <select
                    class="form-select"
                    [name]="'type_'+$index"
                    [(ngModel)]="row.typeId"
                  >
                    <option value="">Typ urządzenia…</option>
                    @for (t of deviceTypes; track t.id) {
                      <option [value]="t.id">{{ t.name }}</option>
                    }
                  </select>
                </div>
                <div class="col-3">
                  <input
                    type="number"
                    min="1"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    class="form-control"
                    [name]="'needed_'+$index"
                    [(ngModel)]="row.needed"
                    placeholder="Ilość"
                  />
                </div>
                <div class="col-1 d-flex justify-content-end">
                  <button type="button" class="modal-close-btn" (click)="removeRow($index)" [disabled]="projectDeviceRows.length===1" aria-label="Usuń wiersz">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- <textarea
          name="notes"
          [(ngModel)]="formData.notes"
          placeholder="NOTATKI"
          rows="4"
          class="form-control"
        ></textarea> -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          ANULUJ
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="projectForm.invalid"
        >
          ZAPISZ
        </button>
      </div>
    </form>
  </div>
</div>
}
